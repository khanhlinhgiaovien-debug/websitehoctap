{% extends "layout.html" %}
{% block title %}Gá»­i bÃ i lÃ m{% endblock %}

{% block content %}
<style>
  /* Style cho feedback section */
  .feedback-box {
    margin-top: 30px;
    padding: 20px;
    border-radius: 8px;
    white-space: pre-wrap; /* Giá»¯ nguyÃªn xuá»‘ng dÃ²ng */
    line-height: 1.8;
    font-size: 15px;
  }
  
  .feedback-box.ai {
    background-color: #e0f2f1;
    border-left: 5px solid #009688;
  }
  
  .feedback-box.score {
    background-color: #fff3e0;
    border-left: 5px solid #ff9800;
  }
  
  .feedback-box h3 {
    margin-top: 0;
    margin-bottom: 15px;
  }
  
  /* Style cho content bÃªn trong */
  .feedback-content {
    white-space: pre-line; /* Xuá»‘ng dÃ²ng theo \n */
    word-wrap: break-word;
  }
  
  /* Style cho bÃ i lÃ m Ä‘Ã£ gá»­i */
  .submission-card {
    border: 1px solid #ccc;
    padding: 20px;
    margin-bottom: 30px;
    border-radius: 8px;
    background: white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .ai-comment {
    background: #f5f5f5;
    padding: 15px;
    border-radius: 5px;
    margin: 15px 0;
    white-space: pre-line;
    line-height: 1.7;
  }
  
  .score-display {
    background: #e8f5e9;
    padding: 15px;
    border-radius: 5px;
    margin: 15px 0;
    white-space: pre-line;
    line-height: 1.7;
  }
  
  .comment-item {
    background: #f9f9f9;
    padding: 12px;
    margin: 10px 0;
    border-left: 3px solid #2196F3;
    border-radius: 4px;
  }
  
  textarea {
    width: 100%;
    height: 80px;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-family: inherit;
    resize: vertical;
  }
  
  input[type="text"], input[type="number"] {
    width: 100%;
    max-width: 400px;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    margin-bottom: 10px;
  }
</style>

<h2>ğŸ“¤ Gá»­i bÃ i lÃ m</h2>

<form method="POST" enctype="multipart/form-data" style="margin-bottom: 30px;">
  <label for="group_name">TÃªn nhÃ³m:</label><br>
  <input type="text" name="group_name" placeholder="Nháº­p tÃªn nhÃ³m" required><br><br>

  <label for="image">Chá»n file (.png, .jpg, .jpeg, .pdf):</label><br>
  <input type="file" name="image" accept=".png,.jpg,.jpeg,.pdf" required><br><br>

  <button type="submit">ğŸ“¤ Gá»­i bÃ i</button>
</form>

{% if feedback %}
  <div class="feedback-box ai">
    <h3>ğŸ¤– Pháº£n há»“i tá»« AI:</h3>
    <div class="feedback-content">{{ feedback }}</div>
  </div>
{% endif %}

{% if score %}
  <div class="feedback-box score">
    <h3>ğŸ“Š ÄÃ¡nh giÃ¡ Ä‘iá»ƒm:</h3>
    <div class="feedback-content">{{ score }}</div>
  </div>
{% endif %}

<hr style="margin: 40px 0;">
<h2>ğŸ“š CÃ¡c bÃ i lÃ m Ä‘Ã£ gá»­i</h2>

{% for img in images %}
  <div class="submission-card">
    <h3>ğŸ‘¥ NhÃ³m: {{ img.group_name }}</h3>

    {% if img.file_type == 'pdf' %}
      <p>ğŸ“„ <a href="{{ url_for('static', filename='uploads/' + img.filename) }}" target="_blank" style="color: #2196F3;">Xem file PDF</a></p>
    {% else %}
      <img src="{{ url_for('static', filename='uploads/' + img.filename) }}" style="max-width: 100%; max-height: 400px; border-radius: 5px; margin: 10px 0;">
    {% endif %}

    <div class="ai-comment">
      <strong>ğŸ¤– Nháº­n xÃ©t cá»§a AI:</strong><br><br>
      {{ img.ai_feedback }}
    </div>

    {% if img.score_feedback %}
      <div class="score-display">
        <strong>ğŸ“Š ÄÃ¡nh giÃ¡ Ä‘iá»ƒm (AI):</strong><br><br>
        {{ img.score_feedback }}
      </div>
    {% endif %}

    <p style="font-size: 18px; margin: 20px 0;">
      <strong>ğŸ“Š Äiá»ƒm trung bÃ¬nh hiá»‡n táº¡i:</strong>
      <span style="color: #4CAF50; font-size: 22px; font-weight: bold;">
        {{ img.average_score if img.average_score else "ChÆ°a cÃ³" }}
      </span>
    </p>

    <hr style="margin: 25px 0; border: none; border-top: 1px dashed #ccc;">

    <form action="{{ url_for('comment', project_id='general', image_id=img.id) }}" method="POST" style="margin-top: 20px;">
      <label for="student_name">TÃªn cá»§a báº¡n:</label><br>
      <input type="text" name="student_name" placeholder="Nháº­p tÃªn" required><br>

      <label for="comment_text">Nháº­n xÃ©t bÃ i lÃ m:</label><br>
      <textarea name="comment_text" placeholder="Viáº¿t nháº­n xÃ©t..." required></textarea><br>

      <label for="score">Cháº¥m Ä‘iá»ƒm (0â€“10):</label><br>
      <input type="number" name="score" placeholder="Nháº­p Ä‘iá»ƒm" min="0" max="10" step="0.1" required style="max-width: 150px;"><br>

      <button type="submit" style="margin-top: 10px;">ğŸ’¬ Gá»­i nháº­n xÃ©t & Ä‘iá»ƒm</button>
    </form>

    {% if img.comments %}
      <h4 style="margin-top: 25px; color: #555;">ğŸ’¬ BÃ¬nh luáº­n & Äiá»ƒm:</h4>
      <div style="margin-left: 0;">
        {% for cmt in img.comments %}
          <div class="comment-item">
            <strong style="color: #2196F3;">{{ cmt.student_name }}:</strong> {{ cmt.comment_text }}
            {% if cmt.score is defined %}
              <span style="float: right; background: #4CAF50; color: white; padding: 3px 10px; border-radius: 12px; font-size: 14px;">
                Äiá»ƒm: {{ cmt.score }}
              </span>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>
{% endfor %}

<div style="margin-top: 30px;">
  <a href="{{ url_for('projects') }}" style="color: #2196F3; text-decoration: none; font-size: 16px;">â¬…ï¸ Quay vá» danh sÃ¡ch Ä‘á» bÃ i</a>
</div>
{% endblock %}